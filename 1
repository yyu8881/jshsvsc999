<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>ğŸ›¼è½®æ»‘å°„å‡»å†’é™© - è·¨å¹³å°ç¥ä½œï¼</title>
<style>
  * { margin: 0; padding: 0; touch-action: none; }
  body { 
    font-family: "å¾®è½¯é›…é»‘", sans-serif; 
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 50%, #a8edea 100%); 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: center; 
    height: 100vh; 
    color: #333; 
    overflow: hidden;
  }
  h1 { 
    font-size: 28px; 
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3); 
    margin-bottom: 10px; 
    animation: glow 2s infinite alternate;
    color: #ff6b35;
  }
  @keyframes glow { 0% { text-shadow: 0 0 5px #ff6b35; } 100% { text-shadow: 0 0 20px #ff6b35, 0 0 30px #fcb69f; } }
  #gameInfo { 
    display: flex; 
    justify-content: space-between; 
    width: 90%; 
    font-size: 18px; 
    font-weight: bold;
    margin-bottom: 15px; 
  }
  #canvas { 
    border: 5px solid rgba(255,107,53,0.6); 
    border-radius: 20px; 
    background: linear-gradient(to bottom, #87CEEB 0%, #90EE90 100%); 
    box-shadow: 0 10px 30px rgba(0,0,0,0.4); 
    touch-action: none;
    position: relative;
  }
  #joystick { 
    position: absolute; 
    bottom: 20px; 
    left: 20px; 
    width: 120px; 
    height: 120px; 
    background: rgba(255,255,255,0.3); 
    border-radius: 50%; 
    opacity: 0; 
    transition: opacity 0.3s; 
    pointer-events: none;
  }
  #joystick-knob { 
    position: absolute; 
    width: 50px; 
    height: 50px; 
    background: #ff6b35; 
    border-radius: 50%; 
    top: 35px; 
    left: 35px; 
    box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
    transition: all 0.1s; 
  }
  #controls { 
    display: flex; 
    gap: 15px; 
    margin-top: 15px; 
    flex-wrap: wrap;
    justify-content: center;
  }
  .ctrl { 
    width: 80px; height: 80px; 
    border-radius: 50%; 
    border: none; 
    font-size: 28px; 
    color: white; 
    cursor: pointer; 
    box-shadow: 0 5px 20px rgba(0,0,0,0.3); 
    transition: all 0.2s; 
  }
  .jump { background: linear-gradient(45deg, #feca57, #ff9ff3); }
  .shoot { background: linear-gradient(45deg, #ff4757, #ff3838); }
  .ctrl:active { transform: scale(0.9); }
  #startBtn, #pauseBtn, #resetBtn, #shareBtn { 
    padding: 15px 30px; 
    font-size: 16px; 
    border: none; 
    border-radius: 30px; 
    background: linear-gradient(45deg, #ff9ff3, #f368e0); 
    color: white; 
    cursor: pointer; 
    box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
    transition: all 0.3s; 
    margin: 5px;
  }
  button:hover { transform: scale(1.05); }
  button:active { transform: scale(0.95); }
  .hidden { display: none !important; }
  #levelInfo { font-size: 20px; color: #ff6b35; text-align: center; margin-bottom: 10px; }
</style>
</head>
<body>
<h1>ğŸ›¼è½®æ»‘å°„å‡»å†’é™©</h1>
<div id="levelInfo">å…³å¡: <span id="level">1</span> | ç”Ÿå‘½: <span id="health">3</span></div>
<div id="gameInfo">
  <div>åˆ†æ•°: <span id="score">0</span></div>
  <div>æ•Œäºº: <span id="enemies">0</span></div>
  <div>æœ€é«˜: <span id="highScore">0</span></div>
</div>
<canvas id="canvas" width="360" height="500"></canvas>
<div id="joystick">
  <div id="joystick-knob"></div>
</div>
<div id="controls">
  <button class="ctrl jump" id="jumpBtn">â¬†ï¸</button>
  <button class="ctrl shoot" id="shootBtn">ğŸ’¥</button>
</div>
<div style="margin-top: 10px;">
  <button id="startBtn">å¼€å§‹è½®æ»‘</button>
  <button id="pauseBtn" class="hidden">æš‚åœ</button>
  <button id="resetBtn">é‡ç©</button>
  <button id="shareBtn">åˆ†äº«æˆ˜ç»©</button>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const WIDTH = 360, HEIGHT = 500;
const GRAVITY = 0.5;
const JUMP = -13;
const MAX_SPEED = 6;

let gameState = {
  level: 1,
  score: 0,
  highScore: localStorage.getItem('skateHighScore') || 0,
  health: 3,
  isPlaying: false,
  isPaused: false
};

let player = {
  x: 50, y: 300, vx: 0, vy: 0, width: 35, height: 45, onGround: false
};

let joystick = {
  active: false,
  centerX: 0, centerY: 0,
  knobX: 0, knobY: 0,
  maxDist: 40,
  power: 0,
  angle: 0
};

let keys = { jump: false, shoot: false };
let bullets = [];
let enemies = [];
let platforms = [];
let particles = [];
let levelCleared = false;

// æ›´å¤šå…³å¡å†…å®¹ (5å…³å¾ªç¯)
const LEVELS = [
  // å…³1: åŸºç¡€
  { platforms: [[0,450,360,50], [120,380,100,20], [220,300,80,20]], enemies: [{x:180,y:420,w:28,h:28,vx:1.5}] },
  // å…³2: è·³è·ƒæŒ‘æˆ˜
  { platforms: [[0,450,360,50], [60,350,70,20], [180,250,90,20], [280,380,70,20]], enemies: [{x:90,y:420,w:28,h:28,vx:2}, {x:250,y:340,w:28,h:28,vx:-1.5}] },
  // å…³3: å¯†é›†æ•Œäºº
  { platforms: [[0,450,360,50], [40,320,60,20], [140,220,70,20], [240,350,60,20]], enemies: [{x:70,y:420,w:28,h:28,vx:2.5}, {x:170,y:290,w:28,h:28,vx:-2}, {x:270,y:420,w:28,h:28,vx:1}] },
  // å…³4: é«˜éš¾åº¦å¹³å°
  { platforms: [[0,450,360,50], [100,280,50,20], [200,380,50,20], [50,200,50,20]], enemies: [{x:130,y:420,w:28,h:28,vx:2}, {x:230,y:350,w:28,h:28,vx:-2.5}, {x:80,y:250,w:28,h:28,vx:1.5}] },
  // å…³5: Bossçº§
  { platforms: [[0,450,360,50], [150,300,80,20]], enemies: [{x:150,y:420,w:40,h:40,vx:3,color:'#ff0000'}] }
];

let currentLevel = LEVELS[0];

// åŠ è½½å…³å¡
function loadLevel(lvl) {
  currentLevel = LEVELS[(lvl-1) % LEVELS.length];
  platforms = currentLevel.platforms.map(p => ({x:p[0], y:p[1], w:p[2], h:p[3]}));
  enemies = currentLevel.enemies.map(e => ({...e, color: e.color || '#ff4444'}));
  player.x = 50;
  player.y = 300;
  levelCleared = false;
  updateLevelDisplay();
}

// æ›´æ–°æ˜¾ç¤º
function updateLevelDisplay() {
  document.getElementById('level').textContent = gameState.level;
}

// ç»˜åˆ¶ç©å®¶ (è½®æ»‘å°‘å¹´)
function drawPlayer() {
  ctx.fillStyle = '#ff6b35';
  ctx.fillRect(player.x, player.y, player.width, player.height);
  ctx.fillStyle = '#fff';
  ctx.fillRect(player.x+8, player.y+8, 6, 6); // çœ¼ç›
  ctx.fillRect(player.x+22, player.y+8, 6, 6);
  // è½®æ»‘é‹
  ctx.fillStyle = '#333';
  ctx.fillRect(player.x+5, player.y+player.height-8, 12, 6);
  ctx.fillRect(player.x+20, player.y+player.height-8, 12, 6);
}

// å…¶ä»–ç»˜åˆ¶å‡½æ•°ç±»ä¼¼ä¹‹å‰
function drawPlatform(p) {
  ctx.fillStyle = '#8B4513';
  ctx.fillRect(p.x, p.y, p.w, p.h);
  ctx.fillStyle = '#A0522D';
  ctx.fillRect(p.x+5, p.y+5, p.w-10, p.h-10);
}

function drawEnemy(e) {
  ctx.fillStyle = e.color;
  ctx.fillRect(e.x, e.y, e.w, e.h);
  ctx.fillStyle = 'white';
  ctx.fillRect(e.x+4, e.y+4, 5, 5);
  ctx.fillRect(e.x+e.w-9, e.y+4, 5, 5);
}

function drawBullet(b) {
  ctx.fillStyle = '#ffeb3b';
  ctx.beginPath();
  ctx.arc(b.x, b.y, 5, 0, Math.PI*2);
  ctx.fill();
}

// ç²’å­
function updateParticles() {
  particles = particles.filter(p => {
    p.x += p.vx;
    p.y += p.vy;
    p.life--;
    ctx.save();
    ctx.globalAlpha = p.life / 25;
    ctx.fillStyle = p.color;
    ctx.fillRect(p.x, p.y, 4, 4);
    ctx.restore();
    return p.life > 0;
  });
}

// æ›´æ–°ç©å®¶ (è½®æ»‘ç‰©ç†)
function updatePlayer() {
  // æ‘‡æ†æ§åˆ¶é€Ÿåº¦
  player.vx = joystick.power * Math.cos(joystick.angle) * MAX_SPEED;
  player.vy += GRAVITY;
  player.x += player.vx * 0.8; // è½®æ»‘æƒ¯æ€§
  player.y += player.vy;

  // è¾¹ç•Œ
  if (player.x < 0) player.x = 0;
  if (player.x > WIDTH - player.width) player.x = WIDTH - player.width;
  if (player.y > HEIGHT) { gameState.health--; respawn(); }

  // å¹³å°ç¢°æ’
  player.onGround = false;
  platforms.forEach(p => {
    if (player.x < p.x + p.w && player.x + player.width > p.x &&
        player.y < p.y + p.h && player.y + player.height > p.y) {
      if (player.vy > 0 && player.y <= p.y + 5) {
        player.y = p.y - player.height;
        player.vy = 0;
        player.onGround = true;
      }
    }
  });

  // æ•Œäººç¢°æ’
  enemies.forEach((e, i) => {
    if (player.x < e.x + e.w && player.x + player.width > e.x &&
        player.y < e.y + e.h && player.y + player.height > e.y) {
      gameState.health--;
      enemies.splice(i, 1);
      addParticles(e.x + e.w/2, e.y + e.h/2, '#ff4444', 12);
      respawn();
    }
  });
}

// æ·»åŠ ç²’å­
function addParticles(x, y, color, count) {
for(è®¾k=0ï¼›k<countï¼›k++){
particles.push({
Xï¼Œyï¼Œ
VXï¼š(Math.random()-0.5)*10ï¼Œ
Vyï¼š(Math.random()-0.5)*10ï¼Œ
å¯¿å‘½ï¼š25ï¼Œ
é¢œè‰²
    });
  }
}

// é‡ç”Ÿ
å‡½æ•°é‡ç”Ÿ(){
if(gameState.Health<=0){
GameOver()ï¼›
è¿”å›ï¼›
  }
player.x=50ï¼›
player.y=300ï¼›
player.vy=0ï¼›
}

// æ›´æ–°æ•Œäºº
å‡½æ•°updateEnemies(){
æ•Œäºº.foreach(e=>{
e.x+=e.vxï¼›
å¦‚æœ(e.x<=0||e.x>=WIDTH-e.w)e.vx*=-1ï¼›
  });
æ–‡ä»¶ã€‚getElementById('æ•Œäºº')ã€‚textContent=æ•Œäºº.é•¿åº¦ï¼›
}

// æ›´æ–°å­å¼¹
å‡½æ•°updateBullets(){
bullet=bullet.filter(b=>{
b.x+=b.vxï¼›
if(b.x>WIDTH||b.x<0)è¿”å›falseï¼›
æ•Œäºº.foreach((eï¼Œi)=>{
if(b.x>e.x&&b.X<e.X+e.W&&B.Y>E.Y&&B.Y<E.y+E.H){
æ•Œäºº.å‰ªæ¥(iï¼Œ1)ï¼›
gameState.score+=150ï¼›
addParticle(e.x+e.W/2ï¼ŒE.Y+E.H/2ï¼Œ'#ffeb3b'ï¼Œ20)ï¼›
è¿”å›falseï¼›
      }
    });
è¿”å›trueï¼›
  });
}

// é€šå…³æ£€æŸ¥
å‡½æ•°checkWin(){
if(æ•Œäºº.é•¿åº¦===0&&ï¼levelCleared){
levelCleared=trueï¼›
gameState.score+=800ï¼›
setTimeout(()=>{
gameState.level++ï¼›
loadLevel(gameState.level)ï¼›
}, 2000);
  }
}

// æ¸¸æˆå¾ªç¯
å‡½æ•°gameloop(){
å¦‚æœ(ï¼gameestate.IsPlaying||gameState.isPaused)è¿”å›requestAnimationFrame(gameloop)ï¼›

ctx.clearRect(0ï¼Œ0ï¼Œå®½åº¦ï¼Œé«˜åº¦)ï¼›

// åŠ¨æ€èƒŒæ™¯ (è½®æ»‘è½¨è¿¹äº‘)
ctx.fillStyle='rgba(255ï¼Œ255ï¼Œ255ï¼Œ0.6)'ï¼›
for(è®¾i=0ï¼›i<4ï¼›i++){
ctx.beginPath()ï¼›
ctx.arc((Date.now()*0.005+i*80)%å®½åº¦ï¼Œ40+i*25ï¼Œ25ï¼Œ0ï¼ŒMath.PI*2)ï¼›
ctx.fill()ï¼›
  }

updatePlayer()ï¼›
updateEnemies()ï¼›
updateBullets()ï¼›
updateParticle()ï¼›
checkWin()ï¼›

å¹³å°.foreach(drawPlatform)ï¼›
æ•Œäºº.foreach(drawEnemy)ï¼›
bullets.forEach(drawBullet)ï¼›
drawPlayer()ï¼›

//UI
æ–‡ä»¶ã€‚getElementById('score')ã€‚textContent=gameStateã€‚åˆ†æ•°ï¼›
æ–‡ä»¶ã€‚getElementById('health')ã€‚textContent=gameStateã€‚å¥åº·ï¼›
if(gameState.score>gameState.highScore){
gameState.highScore=gameState.scoreï¼›
localStorageã€‚setitem('skateHighScore'ï¼ŒgameState.highscore)ï¼›
  }
æ–‡ä»¶ã€‚getElementById('highscore')ã€‚textContent=gameStateã€‚highscoreï¼›

requestAnimationFrame(æ¸¸æˆå¾ªç¯)ï¼›
}

// æ‘‡æ†äº‹ä»¶
Const joysteEl=document.getElementById('joyste')ï¼›
å¸¸æ•°Knobel=document.getElementById('æ“çºµæ†-æ—‹é’®')ï¼›

åŠŸèƒ½æ›´æ–°æ“çºµæ†(Touchxï¼ŒtouchY){
Const dx=Touchx-æ“çºµæ†.centerXï¼›
Const dy=touchy-æ“çºµæ†ã€‚ä¸­å¿ƒï¼›
Const dist=Math.sqrt(dx*dx+dy*dy)ï¼›
if(è·ç¦»<æ“çºµæ†.maxDist){
æ“çºµæ†.æ—‹é’®X=Touchx-æ“çºµæ†.ä¸­å¿ƒX+æ“çºµæ†.ä¸­å¿ƒX-25ï¼›
ä¹”ä¼Šæ–¯ç‰¹ã€‚Knoby=è§¦æ‘¸Y-å¤§è±†.centerery+å¤§è±†.ä¸­å¿ƒY-25ï¼›
æ“çºµæ†åŠŸç‡=è·ç¦»/æ“çºµæ†æœ€å¤§è·ç¦»ï¼›
æ“çºµæ†è§’åº¦=Math.atan2(dyï¼Œdx)ï¼›
}else{
const angle=Math.atan2(dyï¼Œdx)ï¼›
æ“çºµæ†.æ—‹é’®X=æ•°å­¦.Cos(è§’åº¦)*æ“çºµæ†.maxè·ç¦»+æ“çºµæ†.centerX-25ï¼›
ä¹”ä¼Šæ–¯ç‰¹Knoby=æ•°å­¦ã€‚sin(è§’åº¦)*joyste.maxDist+joyste.centerY-25ï¼›
æ“çºµæ†åŠŸç‡=1ï¼›
æ“çºµæ†ã€‚è§’åº¦=è§’åº¦ï¼›
  }
}

canvas.addEventListener('touchstart'ï¼Œ(e)=>{
e.preventDefault()ï¼›
Const rect=canvas.getBoundingClientRect()ï¼›
Const touch=e.touches[0]ï¼›
å¸¸æ•°X=touch.clientX-rect.leftï¼›
å¸¸æ•°y=touch.clientY-rect.topï¼›
if(x<WIDTH/2&&y>HEIGHT-150){//å·¦ä¾§æ‘‡æ†åŒº
joyste.active=çœŸï¼›
æ“çºµæ†El.style.opacity='0.8'ï¼›
æ“çºµæ†.ä¸­å¿ƒX=xï¼›
æ“çºµæ†.ä¸­å¿ƒ=yï¼›
æ“çºµæ†.æ—‹é’®X=X-25ï¼›
æ“çºµæ†.æ—‹é’®=Y-25ï¼›
æ“çºµæ†åŠŸç‡=0ï¼›
  }
});

canvas.addEventListener('touchmove'ï¼Œ(e)=>{
e.preventDefault()ï¼›
if(ï¼joyste.active)è¿”å›ï¼›
Const rect=canvas.getBoundingClientRect()ï¼›
Const touch=e.touches[0]ï¼›
å¸¸æ•°X=touch.clientX-rect.leftï¼›
å¸¸æ•°y=touch.clientY-rect.topï¼›
æ›´æ–°æ“çºµæ†(xï¼Œy)ï¼›
æ—‹é’®El.style.left=æ“çºµæ†.æ—‹é’®X+'px'ï¼›
æ—‹é’®El.style.top=æ“çºµæ†.æ—‹é’®+'px'ï¼›
});

canvas.addEventListener('touchend'ï¼Œ(e)=>{
e.preventDefault()ï¼›
if(æ“çºµæ†æ¿€æ´»){
æ“çºµæ†.active=falseï¼›
goystoreEl.style.opacity="0"ï¼›
æ“çºµæ†åŠŸç‡=0ï¼›
æ“çºµæ†.æ—‹é’®X=æ“çºµæ†.ä¸­å¿ƒX-25ï¼›
joyste.knobY=joyste.centerY-25ï¼›
æ—‹é’®El.style.left=æ“çºµæ†.æ—‹é’®X+'px'ï¼›
æ—‹é’®El.style.top=æ“çºµæ†.æ—‹é’®+'px'ï¼›
  }
});

// æŒ‰é’®æ§åˆ¶
['jumpBtn'ï¼Œ'shootBtn'].forEach(id=>{
Const btn=document.getElementById(id)ï¼›
BTN.ontouchstart=()=>keys[id.replace('Btn'ï¼Œ")]=trueï¼›
BTN.ontouchend=()=>é”®[id.replace('Btn'ï¼Œ")]=falseï¼›
BTN.onmousedown=()=>keys[id.replace('Btn'ï¼Œ")]=trueï¼›
BTN.onmouseup=()=>keys[id.replace('Btn'ï¼Œ")]=falseï¼›
});

// è¾“å…¥å¤„ç†
å‡½æ•°handleInput(){
if(keys.jump&&player.onGround){
player.vy=è·³è½¬ï¼›
addParticle(æ’­æ”¾å™¨ã€‚X+æ’­æ”¾å™¨.å®½åº¦/2ï¼Œæ’­æ”¾å™¨.y+æ’­æ”¾å™¨.é«˜åº¦ï¼Œ'#ff6b35'ï¼Œ8)ï¼›
keys.jump=falseï¼›
  }
if(keys.shoot){
å­å¼¹ã€‚æ¨åŠ¨({x:player.X+playerã€‚å®½åº¦ï¼Œy:player.y+20ï¼Œvx:10ï¼Œvy:0})ï¼›
addParticle(player.x+player.å®½åº¦ï¼Œplayer.y+20ï¼Œ'#ffeb3b'ï¼Œ5)ï¼›
keys.shoot=falseï¼›
  }
}

// ä¸»å¾ªç¯
å‡½æ•°mainloop(){
handleInput()ï¼›
gameloop()ï¼›
requestAnimationFrame(ä¸»å¾ªç¯)ï¼›
}

// æ¸¸æˆç»“æŸ
å‡½æ•°GameOver(){
gameState.isplaying=falseï¼›
alert('è½®æ»‘å†’é™©ç»“æŸï¼æœ€ç»ˆåˆ†æ•°ï¼š${gameState.score}\nç»§ç»­æŒ‘æˆ˜æ›´é«˜å…³ï¼â€˜)ï¼›
}

// æŒ‰é’®äº‹ä»¶
æ–‡ä»¶ã€‚getElementById('startBtn').onclick=()=>{
gameState.isplaying=trueï¼›
gameState.isPaused=falseï¼›
loadLevel(1)ï¼›
æ–‡ä»¶ã€‚getElementById('startBtn').classList.add('hidden')ï¼›
æ–‡ä»¶ã€‚getElementById('pauseBtn').classList.remove('hidden')ï¼›
ä¸»å›è·¯()ï¼›
};

æ–‡ä»¶ã€‚getElementById('pauseBtn').onclick=()=>{
gameState.isPaused=ï¼gameState.isPausedï¼›
æ–‡ä»¶ã€‚getElementById('pauseBtn')ã€‚textContent=gameStateã€‚IsPausedï¼Ÿ'ç»§ç»­'ï¼š'æš‚åœ'ï¼›
};

æ–‡ä»¶ã€‚getElementById('resetBtn').onclick=()=>{
gameState.isplaying=falseï¼›
gameState.level=1ï¼›
gameState.score=0ï¼›
gameState.Health=3ï¼›
loadLevel(1)ï¼›
æ–‡ä»¶ã€‚getElementById('startBtn').classList.remove('hidden')ï¼›
æ–‡ä»¶ã€‚getElementById('pauseBtn').classList.add('hidden')ï¼›
};

æ–‡ä»¶ã€‚getElementById('shareBtn').onclick=()=>{
å¸¸é‡æ–‡æœ¬='è½®æ»‘å°„å‡»å†’é™©ç¬¬\({gameState.level}å…³ï¼\){gameState.score}åˆ†é«˜åˆ†ï¼Œæ‘‡æ†ç§»åŠ¨è¶…ä¸æ»‘ï¼æ¥PKğŸ›¼ #è½®æ»‘å†’é™©#å°„å‡»é—¯å…³#æŠ–éŸ³å°æ¸¸æˆ'ï¼›
if(navigator.share){
navigator.share({titleï¼š'è½®æ»‘å°„å‡»å†’é™©'ï¼Œtextï¼Œurl:window.location.href})ï¼›
}else{
é¢†èˆªå‘˜ã€‚å‰ªè´´æ¿ã€‚WRITETEXT(æ–‡æœ¬)ã€‚ç„¶å(()=>è­¦æŠ¥('æ–‡æ¡ˆå¤åˆ¶æˆåŠŸï¼Œå»æŠ–éŸ³å‘è§†é¢‘èµ·é£ï¼'))ï¼›
  }
};

// åˆå§‹åŒ–
updateLevelDisplay()ï¼›
æ“çºµæ†.centerX=80ï¼›
æ“çºµæ†.ä¸­å¿ƒ=é«˜åº¦-80ï¼›
</script>
</body>
</html>
